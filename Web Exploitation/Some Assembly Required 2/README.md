# Some Assembly Required 3

## Description

[http://mercury.picoctf.net:23889/index.html](http://mercury.picoctf.net:23889/index.html)

## Hints

(None)

## Solution

Deobfuscated JS:

```javascript
let exports;

(async () => {
    let wasmBin = await fetch('./aD8SvhyVkb');
    let wasmInit = await WebAssembly.instantiate(await wasmBin.arrayBuffer());
    let wasmInstance = wasmInit.instance;
    exports = wasmInstance.exports;
})();

function onButtonPress() {
    let input = document.getElementById('input').value;
    for (let i = 0; i < input.length; i++) {
        exports.copy_char(input.charCodeAt(i), i);
    }
    exports.copy_char(0, input.length), exports.check_flag() == 1 ? document.getElementById('result').innerHTML = 'Correct!' : document.getElementById('result').innerHTML = 'Incorrect!';
}
```

Decompiled WASM (sections of interest):

```
export global input:int = 1072;
data d_a(offset: 1024) = 
"xakgK\Nsl<8?nmi:<i;0j9:;?nm8i=0??:=njn=9u\00\00";

function copy(a:int, b:int) {
  var c:int = g_a;
  var d:int = 16;
  var e:int_ptr = c - d;
  e[3] = a;
  e[2] = b;
  var f:int = e[3];
  if (eqz(f)) goto B_a;
  var g:int = e[3];
  var h:int = 8;
  var i:int = g ^ h;
  e[3] = i;
  label B_a:
  var j:int = e[3];
  var k:byte_ptr = e[2];
  k[1072] = j;
}
```

Deobfuscated pseudocode of `copy` (Python):

```python
def copy(char, index):
    # null character check
    if char != 0:
        char = char ^ 8
    output[index] = char
```

Since xor is symmetrical, we can just xor every character in the data string with 8 again to get the flag. The solution can be found in [solve.py](./solve.py).

## Flag

picoCTF{d407fea24a38b1237fe0a587725fbf51}
