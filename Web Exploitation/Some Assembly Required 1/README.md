# Some Assembly Required 1

## Problem Description

[http://mercury.picoctf.net:37669/index.html](http://mercury.picoctf.net:37669/index.html)

## Hints

(None)

## Solution

Since we don't know the flag, we poke around on the website to try to find the validation mechanism, which could be client-side. Indeed, we find G82XCw5CX3.js, which is some obfuscated Javascript code. Here is it, deobfuscated.

```js
let exports;

(async () => {
    let wasmBin = await fetch('./JIFxzHyW8W');
    let wasmInit = await WebAssembly.instantiate(await wasmBin.arrayBuffer());
    let wasmInstance = wasmInit.instance;
    exports = wasmInstance.exports;
})();

function onButtonPress() {
    let input = document.getElementById('input').value;
    for (let i = 0; i < input.length; i++) {
        exports.copy_char(input.charCodeAt(i), i);
    }
    exports.copy_char(0, input.length), exports.check_flag() == 1 ? document.getElementById('result').innerHTML = 'Correct!' : document.getElementById('result').innerHTML = 'Incorrect!';
}
```

First, there is a function being executed which fetches what seems to be a compiled web assembly file. In the onButtonPress function, the code calls the copy_char function (assumed to be defined in the wasm) with each character and index, and then uses it to check the flag. If we go to ./JIFxzHyW8W, we can get the wasm file as well, which we can decompile using a tool such as wasm-decompile.

```
export memory memory(initial: 2, max: 0);

global g_a:int = 66864;
export global input:int = 1072;
global dso_handle:int = 1024;
global data_end:int = 1328;
global global_base:int = 1024;
global heap_base:int = 66864;
global memory_base:int = 0;
global table_base:int = 1;

table T_a:funcref(min: 1, max: 1);

data d_a(offset: 1024) =
"picoCTF{a8bae10f4d9544110222c2d639dc6de6}\00\00";

function wasm_call_ctors() {
}

export function strcmp(a:int, b:int):int {
  var c:int = g_a;
  var d:int = 32;
  var e:int = c - d;
  e[6]:int = a;
  e[5]:int = b;
  var f:int = e[6]:int;
  e[4]:int = f;
  var g:int = e[5]:int;
  e[3]:int = g;
  loop L_b {
    var h:ubyte_ptr = e[4]:int;
    var i:int = 1;
    var j:int = h + i;
    e[4]:int = j;
    var k:int = h[0];
    e[11]:byte = k;
    var l:ubyte_ptr = e[3]:int;
    var m:int = 1;
    var n:int = l + m;
    e[3]:int = n;
    var o:int = l[0];
    e[10]:byte = o;
    var p:int = e[11]:ubyte;
    var q:int = 255;
    var r:int = p & q;
    if (r) goto B_c;
    var s:int = e[11]:ubyte;
    var t:int = 255;
    var u:int = s & t;
    var v:int = e[10]:ubyte;
    var w:int = 255;
    var x:int = v & w;
    var y:int = u - x;
    e[7]:int = y;
    goto B_a;
    label B_c:
    var z:int = e[11]:ubyte;
    var aa:int = 255;
    var ba:int = z & aa;
    var ca:int = e[10]:ubyte;
    var da:int = 255;
    var ea:int = ca & da;
    var fa:int = ba;
    var ga:int = ea;
    var ha:int = fa == ga;
    var ia:int = 1;
    var ja:int = ha & ia;
    if (ja) continue L_b;
  }
  var ka:int = e[11]:ubyte;
  var la:int = 255;
  var ma:int = ka & la;
  var na:int = e[10]:ubyte;
  var oa:int = 255;
  var pa:int = na & oa;
  var qa:int = ma - pa;
  e[7]:int = qa;
  label B_a:
  var ra:int = e[7]:int;
  return ra;
}

export function check_flag():int {
  var a:int = 0;
  var b:int = 1072;
  var c:int = 1024;
  var d:int = strcmp(c, b);
  var e:int = d;
  var f:int = a;
  var g:int = e != f;
  var h:int = -1;
  var i:int = g ^ h;
  var j:int = 1;
  var k:int = i & j;
  return k;
}

function copy(a:int, b:int) {
  var c:int = g_a;
  var d:int = 16;
  var e:int_ptr = c - d;
  e[3] = a;
  e[2] = b;
  var f:int = e[3];
  var g:byte_ptr = e[2];
  g[1072] = f;
}
```

If we make this code more readable, we can see that the check_flag function just checks whether the input string is the same as a string in memory. The copy function is used to populate the input string. Although the flag is directly accessible through the source code for now, this information will be useful in future challenges.

For now, we can just take the given flag. Don't forget to discard the null characters at the end.

## Flag

picoCTF{a8bae10f4d9544110222c2d639dc6de6}
